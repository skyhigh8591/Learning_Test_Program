C51 COMPILER V8.17   LCD2A                                                                 09/02/2009 16:15:00 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE LCD2A
OBJECT MODULE PLACED IN LCD2A.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LCD2A.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /************** LCD2A.C *****************************
   2          *動作：在LCD顯示"COUNT="，再重覆顯示-9999~+9999
   3          ***********************************************/
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5          char code  Table[]="COUNT="; //第一行陣列字元
   6          void LCD_Disp(int count);
   7          
   8          void main(void)
   9          {
  10   1         int count=-9980; //顯示計數十進制初值
  11   1         char i;                //陣列資料計數
  12   1         LCD_init();        //重置及清除LCD    
  13   1         LCD_Cmd(0x80);     //游標由第一行開始顯示  
  14   1         for(i=0; i<6; i++) //讀取陣列"COUNT= "字元到LCD顯示出來 
  15   1            LCD_Data(Table[i]);   
  16   1         while(1)         //重覆執行
  17   1         {
  18   2           LCD_Cmd(0x86);    //游標由第一行第6字開始顯示  
  19   2           LCD_Disp(count--);//顯示4位數十進制計數及計數遞減
  20   2               if(count > 9999) count=-9999; 
  21   2               if(count < -9999) count=9999;
  22   2           Delay_ms(100);
  23   2         }
  24   1       }
  25          /********************************************************
  26          *函數名稱: LCD_Dis
  27          *功能描述: LCD顯示4位數有正負符號十進制數字
  28          *輸入參數：disp
  29          *******************************************************/
  30          void LCD_Disp(int disp) 
  31          {
  32   1       if(disp<0) {LCD_Data('-');disp=-disp;}
  33   1          else     LCD_Data('+');
  34   1       if(disp>999)  LCD_Data(disp /1000+'0');       //顯示千位數
  35   1       if(disp>99)   LCD_Data(disp % 1000/100+'0');  //顯示百位數
  36   1       if(disp>9)    LCD_Data(disp % 100/10+'0');    //顯示十位數
  37   1                     LCD_Data(disp % 10+'0');        //顯示個位數
  38   1      } 
  39          /***********************************************************
  40          *函數名稱: LCD_Data
  41          *功能描述: 傳送資料到文字型LCD
  42          *輸入參數：dat
  43          ************************************************************/
  44          void LCD_Data(unsigned char dat)  //傳送資料到LCD
  45          {
  46   1          unsigned char dly=2;
  47   1              Data=dat;      //資料送到BUS
  48   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  49   1          while(dly--);
  50   1              EN=0;          //禁能LCD 
  51   1              LCD_wait();    //LCD等待寫入完成  
  52   1      }
  53          /***************************************************************
  54          *函數名稱: LCD_Cmd
  55          *功能描述: 傳送命令到文字型LCD
C51 COMPILER V8.17   LCD2A                                                                 09/02/2009 16:15:00 PAGE 2   

  56          *輸入參數：Cmd
  57          ************************************************************/
  58          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  59          {
  60   1          unsigned char dly=2;
  61   1              Data=Cmd;       //命令送到BUS
  62   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  63   1          while(dly--);
  64   1          EN=0;           //禁能LCD
  65   1              LCD_wait(); //LCD等待寫入完成 
  66   1      }
  67          /***************************************************************
  68          *函數名稱: LCD_Cmd
  69          *功能描述: 傳送命令到文字型LCD
  70          *輸入參數：Cmd
  71          ************************************************************/
  72          void LCD_Cmd_Init(unsigned char Cmd) //傳送命令到LCD
  73          {
  74   1              Data=Cmd;       //命令送到BUS
  75   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  76   1          Delay_ms(1);
  77   1          EN=0;           //禁能LCD
  78   1          Delay_ms(1);
  79   1      }
  80          /***************************************************************
  81          *函數名稱: LCD_init
  82          *功能描述: 啟始化文字型LCD
  83          *****************************************************************/
  84          void LCD_init(void)    //LCD的啟始程式  
  85          {
  86   1          LCD_Cmd_Init(0x38);//0011 1000,8bit傳輸,顯示2行,5*7字型
  87   1          LCD_Cmd_Init(0x38);//bit4:DL=1,8bit傳輸,
  88   1          LCD_Cmd_Init(0x38);//bit3:N=1,顯示2行
  89   1                             //bit2:F=0,5*7字型    
  90   1          LCD_Cmd_Init(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  91   1                               bit2:D=1,顯示幕ON
  92   1                               bit1:C=0,不顯示游標
  93   1                                   bit0:B=0,游標不閃爍*/
  94   1          LCD_Cmd_Init(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  95   1                               bit1:I/D=1,顯示完游標右移,
  96   1                               bit0:S=0,游標移位禁能*/  
  97   1          LCD_Cmd_Init(0x01); //清除顯示幕  
  98   1          LCD_Cmd_Init(0x02); //游標回原位  
  99   1      }
 100          /**************************************************
 101          *函數名稱: LCD_wait
 102          *功能描述: LCD等待忙碌旗標BF
 103          ****************************************************/
 104          void LCD_wait(void)
 105          {
 106   1        unsigned char status;  //定義LCD讀取狀態
 107   1        Data=0xff; //P0設定為輸入埠
 108   1        do
 109   1        {
 110   2          RS=0;RW=1;EN=1; //讀取命令
 111   2          status= Data;       //輸入LCD的命令
 112   2          EN=0;                       //禁能LCD
 113   2        }
 114   1        while(status & 0x80); //等待忙碌旗標BF=0
 115   1      }


C51 COMPILER V8.17   LCD2A                                                                 09/02/2009 16:15:00 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    479    ----
   CONSTANT SIZE    =      7    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
