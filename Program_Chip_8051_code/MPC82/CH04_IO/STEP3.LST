C51 COMPILER V8.17   STEP3                                                                 09/05/2009 11:24:01 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE STEP3
OBJECT MODULE PLACED IN STEP3.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE STEP3.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********** STEP3.C *********************************
   2          *動作：將各種動作存在陣列資料內，以自動方式控制步進馬達運轉 
   3          *      第一個為功能資料：0=從頭開始，1=正轉CW,2=反轉CCW，3=停止
   4          *      第二個為步數資料：指定步進馬達行進步數
   5          *      第三個為延時資料：指定步進馬達每步的時間，或停止的時間
   6          *硬體：SW1-3(POLED)ON及SW2-1~4(STEP)ON
   7          ***********************************************/
   8          #include "..\MPC82.H"   //暫存器及組態定義
   9          unsigned char run_Table[]={0x1,0x2,0x4,0x8};//驅動數碼
  10          
  11          unsigned int code func_Table[] //步進馬達動作 
  12              = {1,200,100, //正轉,step=30,delay=0.1sec 
  13                 1,200,100, 
  14                     3,1000,   //停止,delay=10sec
  15                 2,20,100, //反轉,step=20,delay=0.1sec 
  16                 3,2000,   //停止,delay=20sec 
  17                 0};      //從頭開始  
  18          
  19          void main()
  20          {
  21   1        char  i=0;  //動作計數
  22   1        char  j=0;  //驅動數碼資料計數
  23   1        char  func; //功能  
  24   1        unsigned char  step; //步數
  25   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  26   1        P1M0=0; P1M1=0xF0; //設定P17-4(STEP)為推挽式輸出(M0-1=01)
  27   1        STEP=0x0F;   //步進馬達初值：P17-4=0000
  28   1        while(1) 
  29   1         {
  30   2          func=func_Table[i]; //讀取功能資料 
  31   2          switch(func)        //執行功能
  32   2           {
  33   3             case 0:        //若功能=0，從頭開始讀取 
  34   3               i=0;         //動作計數=0，從頭開始讀取 
  35   3              break;        //退出 
  36   3             
  37   3             case 1:               //若功能=1,正轉 
  38   3               i++;                //動作計數+1
  39   3               step=func_Table[i]; //讀取步數資料
  40   3               i++;                //動作計數+1
  41   3               while(step--)           //步數-1,若大於0則繼續運轉
  42   3                {
  43   4                 j++;              //驅動數碼資料+1  
  44   4                 if (j>3) j=0;     //正轉資料計數>3,j=0           
  45   4                 LED=~run_Table[j];     //讀取驅動數碼由LED輸出 
  46   4                      STEP=run_Table[j]<<4; //讀取驅動數碼由步進馬達輸出
  47   4                 Delay_ms(func_Table[i]);//延時時間，實際電路須加長
  48   4                } 
  49   3              i++;                 //動作計數+1
  50   3              break;               //退出
  51   3             
  52   3             case 2:               //若功能=2,反轉
  53   3              i++;                 //動作計數+1
  54   3              step=func_Table[i];  //讀取步數資料
  55   3              i++;                 //動作計數+1
C51 COMPILER V8.17   STEP3                                                                 09/05/2009 11:24:01 PAGE 2   

  56   3              while(step--)            //步數-1,若大於0則繼續運轉
  57   3               {
  58   4                j--;               //驅動數碼資料-1
  59   4                if (j<0) j=3;      //反轉資料計數<0,j=3
  60   4                LED=~run_Table[j];     //讀取驅動數碼由LED輸出 
  61   4                     STEP=run_Table[j]<<4; //讀取驅動數碼由步進馬達輸出
  62   4                Delay_ms(func_Table[i]);//延時時間，實際電路須加長
  63   4               }
  64   3              i++;             //動作計數+1
  65   3              break;           //退出
  66   3              
  67   3             case 3:           //若功能=3,停止
  68   3              i++;             //動作計數+1
  69   3              Delay_ms(func_Table[i]); //停止時間，實際電路須加長
  70   3              i++;             //動作計數+1
  71   3              break;           //退出
  72   3           }
  73   2        }
  74   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    420    ----
   CONSTANT SIZE    =     28    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
