"File: U1_2_1.asm    Assembler  Version 2.98      Page 1


   1  0000              ;PROGRAM : U1_2_1.ASM 							2017.0413
   2  0000              ;FUNCTION: 7 SEGMENT LED DEMO PROGRAM(ITABRD)	By Steven   
   3  0000              #INCLUDE  HT66F2390.INC 


   4  0000              ;========================================================================================
   5  0000              MY_DATA    .SECTION  'DATA'         	;== DATA SECTION == 
   6  0000  00          DEL1      	DB  	?       			;DELAY LOOP COUNT 1 
   7  0001  00          DEL2      	DB   	?       			;DELAY LOOP COUNT 2 
   8  0002  00          DEL3	    DB  	?       			;DELAY LOOP COUNT 3 
   9  0003  00          COUNT   	DB  	? 
  10  0004              ;========================================================================================
  11  0004              SEG_PORT 	EQU  	PG   				;DEFINE 7-SEGMENT LED PORT 
  12  0004              SEG_PORTC  	EQU    	PGC     			;DEFINE SEG_PORT CONTROL REG. 
  13  0000              MY_CODE  .SECTION  AT 0  'CODE'     	;== PROGRAM SECTION , 重置向量(RESET VECTOR) 
  14  0000  0FAB        		MOV		A,0ABh					;關閉WDT
  15  0001  00BE        		MOV		WDTC,A
  16  0002  1F27        		CLR    	SEG_PORT				;設置輸出Low
  17  0003  1F28        		CLR    	SEG_PORTC      			;規劃PORT為輸出屬性
  18  0004              MAIN:         
  19  0004  0F00        		MOV    	A,HIGH (TAB_7_SEG-1) 
  20  0005  0089        		MOV  	TBHP,A    				;取得建表起始位址(High-byte) 
  21  0006  0F1B        		MOV    	A,LOW  (TAB_7_SEG-1) 
  22  0007  0087        		MOV  	TBLP,A    				;取得建表起始位址(Low-byte)  
  23  0008  0F0A        		MOV    	A,10 
  24  0009  0080     R  		MOV    	COUNT,A      			;設定迴圈次數 
  25  000A              LOOP: 
  26  000A  1C27        		ITABRD	SEG_PORT     			;取得建表資料，並將Low-byte送至SEG_PORT 
  27  000B  0708        		MOV  	A,TBLH   				;取得High-byte資料 
  28  000C  2010        		CALL    DELAY    				;延遲ACC*10ms 
  29  000D  1780     R  		SDZ    	COUNT      				;(COUNT=COUNT-1)是否為0?
  30  000E  280A        		JMP  	LOOP    				;否，迴圈繼續 
  31  000F  2804        		JMP  	MAIN    				;是，重新執行
  32  0010              ;========================================================================================
  33  0010              ; PROC	: DELAY
  34  0010              ; FUNC	: DEALY ABOUT ACC*10mS @fSYS=8MHz
  35  0010              ; PARA	: ACC : DELAY FACTOR
  36  0010              ; REG	: DEL1,DEL2,DEL3
  37  0010              ;======================================================================================== 
  38  0010              DELAY	PROC
  39  0010  0080     R  		MOV		DEL1,A					;SET DEL1 COUNTER	
  40  0011  0F1E        DEL_1:  MOV		A,30		        	                   	
  41  0012  0080     R  		MOV		DEL2,A					;SET DEL2 COUNTER 
  42  0013  0FDC        DEL_2:	MOV		A,220
  43  0014  0080     R  		MOV		DEL3,A					;SET DEL3 COUNTER
  44  0015  1780     R  DEL_3:	SDZ		DEL3                  	;DEL3 DOWN COUNT
  45  0016  2815        		JMP		DEL_3                      
  46  0017  1780     R  		SDZ		DEL2                  	;DEL2 DOWN COUNT
  47  0018  2813        		JMP		DEL_2                   
  48  0019  1780     R  		SDZ		DEL1					;DEL1 DOWN COUNT
  49  001A  2811        		JMP		DEL_1
  50  001B  0003        		RET
  51  001C              DELAY	ENDP
  52  001C              TAB_7_SEG: 
  53  001C  143F        		DC      (20 SHL 8)+03Fh  		;共陰極七段顯示器(0~9)顯示碼建表區
  54  001D  1E06        		DC    	(30 SHL 8)+006h  		;High-byte為延遲時間常數
  55  001E  285B        		DC    	(40 SHL 8)+05Bh  		;Low-byte為七段顯示器顯示碼
  56  001F  324F        		DC     	(50 SHL 8)+04Fh  		
  57  0020  3C66        		DC     	(60 SHL 8)+066h 
"File: U1_2_1.asm    Assembler  Version 2.98      Page 2

  58  0021  466D        		DC    	(70 SHL 8)+06Dh 
  59  0022  507D        		DC     	(80 SHL 8)+07Dh
  60  0023  5A07        		DC     	(90 SHL 8)+007h 
  61  0024  647F        		DC     	(100 SHL 8)+07Fh 
  62  0025  6E67        		DC     	(110 SHL 8)+067h 
  63  0026              		END 


        0 Errors, 0 Warnings