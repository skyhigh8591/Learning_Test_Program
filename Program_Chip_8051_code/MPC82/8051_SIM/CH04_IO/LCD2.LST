C51 COMPILER V8.17   LCD2                                                                  09/02/2009 16:04:54 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE LCD2
OBJECT MODULE PLACED IN LCD2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LCD2.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /************** LCD2.C *****************************
   2          *動作：在LCD顯示"COUNT="，再重覆顯示00000~65535
   3          ***********************************************/
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5          char code  Table[]="COUNT="; //第一行陣列字元
   6          void LCD_Disp(unsigned int disp); // LCD 十進制5位數顯示
   7          
   8          void main(void)
   9          {
  10   1         unsigned int count=12345; //顯示計數十進制初值
  11   1         char i;                //陣列資料計數
  12   1         LCD_init();        //重置及清除LCD    
  13   1         LCD_Cmd(0x80);     //游標由第一行開始顯示  
  14   1         for(i=0; i<6; i++) //讀取陣列"COUNT= "字元到LCD顯示出來 
  15   1            LCD_Data(Table[i]);   
  16   1         while(1)         //重覆執行
  17   1         {
  18   2           LCD_Cmd(0x86);    //游標由第一行第6字開始顯示  
  19   2           LCD_Disp(count++);//顯示5位數十進制計數及計數遞加
  20   2           Delay_ms(300);
  21   2         }
  22   1       }
  23          /********************************************************
  24          *函數名稱: LCD_Disp(unsigned int disp)
  25          *功能描述: LCD顯示5位數十進制數字
  26          *輸入參數：disp
  27          *******************************************************/
  28          void LCD_Disp(unsigned int disp)  // LCD 十進制5位數顯示
  29          {
  30   1       if(disp>9999) LCD_Data(disp /10000+'0'); //顯示萬位數字
  31   1       if(disp>999)  LCD_Data(disp % 10000/1000+'0');//顯示千位數
  32   1       if(disp>99)   LCD_Data(disp % 1000/100+'0');  //顯示百位數
  33   1       if(disp>9)    LCD_Data(disp % 100/10+'0');    //顯示十位數
  34   1                     LCD_Data(disp % 10+'0');        //顯示個位數
  35   1      } 
  36          /***********************************************************
  37          *函數名稱: LCD_Data
  38          *功能描述: 傳送資料到文字型LCD
  39          *輸入參數：dat
  40          ************************************************************/
  41          void LCD_Data(unsigned char dat)  //傳送資料到LCD
  42          {
  43   1          unsigned char dly=2;
  44   1              Data=dat;      //資料送到BUS
  45   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  46   1          while(dly--);
  47   1              EN=0;          //禁能LCD 
  48   1              LCD_wait();    //LCD等待寫入完成  
  49   1      }
  50          /***************************************************************
  51          *函數名稱: LCD_Cmd
  52          *功能描述: 傳送命令到文字型LCD
  53          *輸入參數：Cmd
  54          ************************************************************/
  55          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
C51 COMPILER V8.17   LCD2                                                                  09/02/2009 16:04:54 PAGE 2   

  56          {
  57   1          unsigned char dly=2;
  58   1              Data=Cmd;       //命令送到BUS
  59   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  60   1          while(dly--);
  61   1          EN=0;           //禁能LCD
  62   1              LCD_wait(); //LCD等待寫入完成 
  63   1      }
  64          /***************************************************************
  65          *函數名稱: LCD_Cmd
  66          *功能描述: 傳送命令到文字型LCD
  67          *輸入參數：Cmd
  68          ************************************************************/
  69          void LCD_Cmd_Init(unsigned char Cmd) //傳送命令到LCD
  70          {
  71   1              Data=Cmd;       //命令送到BUS
  72   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  73   1          Delay_ms(1);
  74   1          EN=0;           //禁能LCD
  75   1          Delay_ms(1);
  76   1      }
  77          /***************************************************************
  78          *函數名稱: LCD_init
  79          *功能描述: 啟始化文字型LCD
  80          *****************************************************************/
  81          void LCD_init(void)    //LCD的啟始程式  
  82          {
  83   1          LCD_Cmd_Init(0x38);//0011 1000,8bit傳輸,顯示2行,5*7字型
  84   1          LCD_Cmd_Init(0x38);//bit4:DL=1,8bit傳輸,
  85   1          LCD_Cmd_Init(0x38);//bit3:N=1,顯示2行
  86   1                             //bit2:F=0,5*7字型    
  87   1          LCD_Cmd_Init(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  88   1                          bit2:D=1,顯示幕ON
  89   1                          bit1:C=0,不顯示游標
  90   1                              bit0:B=0,游標不閃爍*/
  91   1          LCD_Cmd_Init(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  92   1                          bit1:I/D=1,顯示完游標右移,
  93   1                          bit0:S=0,游標移位禁能*/  
  94   1          LCD_Cmd_Init(0x01); //清除顯示幕  
  95   1          LCD_Cmd_Init(0x02); //游標回原位  
  96   1      }
  97          /**************************************************
  98          *函數名稱: LCD_wait
  99          *功能描述: LCD等待忙碌旗標BF
 100          ****************************************************/
 101          void LCD_wait(void)
 102          {
 103   1        unsigned char status;  //定義LCD讀取狀態
 104   1        Data=0xff; //P0設定為輸入埠
 105   1        do
 106   1        {
 107   2          RS=0;RW=1;EN=1;//讀取命令
 108   2          status= Data;       //輸入LCD的命令
 109   2          EN=0;                       //禁能LCD
 110   2        }
 111   1        while(status & 0x80); //等待忙碌旗標BF=0
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    446    ----
   CONSTANT SIZE    =      7    ----
C51 COMPILER V8.17   LCD2                                                                  09/02/2009 16:04:54 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
