C51 COMPILER V9.56.0.0   CALENDAR1                                                         03/11/2020 14:34:51 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE CALENDAR1
OBJECT MODULE PLACED IN calendar1.OBJ
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE calendar1.c OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //************* calendar1.c *************************************
   2          //動作：以Timer2計時中斷，在LCD顯示電子鐘時、分、秒
   3          //*************************************************************
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5                            //Fosc=22.1184MHz，Timer時脈=Fosc/12=1.8432MHz
   6          #define T  57600  //Timer延時時間=(1/1.8432MHz)*57600=31250uS
   7           unsigned char dly_sec=32; //設定計時重覆次數，時間=31250uS*32=1秒
   8           unsigned char hor=13,min=32,sec=55;  //設定時、分秒初值  
   9           bit flag=0;  //flag=0 CPU進入IDLE
  10          main()
  11          {
  12   1         EA=1; ET2=1; //致能Timet2計時溢位中斷
  13   1         T2CON=0x00; //設定為內部計時，溢位重新載入
  14   1         RCAP2=T2R=65536-T; //設定Timer2及重新載入時間
  15   1         TR2=1;      //啟動Timet2
  16   1                      
  17   1         LCD_init();           //重置及清除LCD 
  18   1      
  19   1         while(1)   //開始顯示及計算萬年曆
  20   1         {  
  21   2           flag=0;
  22   2           while(flag==0) PCON=IDL; 
  23   2           LCD_Cmd(0x80); //顯示第一行位置
  24   2            LCD_Data(hor/10+'0');LCD_Data(hor%10+'0'); //顯示時
  25   2            LCD_Data(':');
  26   2                 
  27   2            LCD_Data(min/10+'0');LCD_Data(min%10+'0'); //顯示分
  28   2            LCD_Data(':');
  29   2          
  30   2            LCD_Data(sec/10+'0'); LCD_Data(sec%10+'0');//顯示秒
  31   2      
  32   2            if (sec < 60) continue; //若秒小於60到while(1)處   
  33   2            sec=0; min++;           //秒等於60則令秒=0，分加一
  34   2            
  35   2          if (min < 60) continue; //若分小於60到while(1)處   
  36   2            min=0; hor++;           //若分等於60則令分=0，時加一
  37   2            
  38   2          if (hor <24)  continue; //若時小於24到while(1)處
  39   2            hor=0; min=0; sec=0;    //若時等於24則令時、分、秒=0 
  40   2        }
  41   1      }
  42          /*******************************************************/ 
  43          void T2_int(void) interrupt 5  //Timet2中斷函數
  44          {
  45   1        dly_sec--;          //計時重覆次數遞減
  46   1        if(dly_sec==0)        //若秒時間到
  47   1         {sec++; dly_sec=32;flag=1;} //秒遞加及重覆次數(設中斷點)
  48   1         TF2=0;    //清除TF2=0
  49   1          
  50   1      }
  51          /***********************************************************
  52          *函數名稱: LCD_Data
  53          *功能描述: 傳送資料到文字型LCD
  54          *輸入參數：dat
  55          ************************************************************/
C51 COMPILER V9.56.0.0   CALENDAR1                                                         03/11/2020 14:34:51 PAGE 2   

  56          void LCD_Data(char dat)  //傳送資料到LCD
  57          {
  58   1          Data=dat; //資料送到BUS
  59   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  60   1          Delay_ms(1);   //LCD等待寫入完成
  61   1          EN=0;          //禁能LCD    
  62   1      }
  63          /***************************************************************
  64          *函數名稱: LCD_Cmd
  65          *功能描述: 傳送命令到文字型LCD
  66          *輸入參數：Cmd
  67          ************************************************************/
  68          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  69          {
  70   1          Data=Cmd;  //命令送到BUS
  71   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  72   1          Delay_ms(1);    //LCD等待寫入完成     
  73   1          EN=0;           //禁能LCD
  74   1      }
  75          /***************************************************************
  76          *函數名稱: LCD_init
  77          *功能描述: 啟始化文字型LCD
  78          *****************************************************************/
  79          void LCD_init(void)    //LCD的啟始程式  
  80          {
  81   1          LCD_Cmd(0x38);/*0011 1000,8bit傳輸,顯示2行,5*7字型
  82   1                          bit4:DL=1,8bit傳輸,
  83   1                          bit3:N=1,顯示2行
  84   1                          bit2:F=0,5*7字型*/    
  85   1          LCD_Cmd(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  86   1                          bit2:D=1,顯示幕ON
  87   1                          bit1:C=0,不顯示游標
  88   1                        bit0:B=0,游標不閃爍*/
  89   1          LCD_Cmd(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  90   1                          bit1:I/D=1,顯示完游標右移,
  91   1                          bit0:S=0,游標移位禁能*/  
  92   1          LCD_Cmd(0x01); //清除顯示幕  
  93   1          LCD_Cmd(0x02); //游標回原位  
  94   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    319    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
