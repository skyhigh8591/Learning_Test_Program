C51 COMPILER V9.03   CAP2                                                                  11/27/2011 16:06:56 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE CAP2
OBJECT MODULE PLACED IN CAP2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE CAP2.c OPTIMIZE(2,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********** CAP2.c ********捕捉器實習範例****************
   2          *動作：令Timer2由T2CKO(P10)輸出方波,送到CEX0(P12)捕捉輸入
   3          *      ，在LED顯示時間差
   4          *硬體：SW1-3(P0LED)ON，將T2CKO(P10)連接到CEX0(P12)
   5          **********************************************/
   6          #include "..\MPC82.H"  //暫存器及組態定義
   7          #define T 0x56 //T2CKO頻率=Fosc/4/(65536-T2)=22118400/4/T                           
   8          main()          
   9          {
  10   1        unsigned int first,i; //第一次CCAP0捕捉時間
  11   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  12   1        T2CON=0x00; /* 0000 0000，設定為內部計時，溢位重新載入
  13   1                       bit3:EXEN2=0,不使用外部T2EX接腳
  14   1                                   bit1:C/T2=0,內部計時 */
  15   1        RCAP2=T2R=65536-T; //設定Timer2及重新載入時間
  16   1        TR2=1;        //啟動Timer2開始計時
  17   1        T2MOD=T2CKOE; //致能T2CKO(P10)輸出方波
  18   1        
  19   1        CCF0 = 0;              //清除模組0的比較旗標
  20   1        CMOD = CPS0;//PCA時脈來源:CPS1-0:01=Fosc/2,配合T2CKO=Fosc/4/(65536-T2)
  21   1        CCAPM0 = CAPP+CAPN; //CAPP=1，正緣及負緣觸發輸入時，CCAP0<--CH:CL)
  22   1        CR = 1;        //啟動PCA計數 
  23   1        while(1)
  24   1         {
  25   2               CL = CH =0;     //PCA計數器由0開始上數
  26   2               while(CCF0==0); //等待第一次觸發輸入
  27   2               CCF0 = 0;               //清除模組0的旗標
  28   2               first=CCAP0L ;  //捕捉CPA計數值
  29   2              
  30   2               while(CCF0==0); //等待第二次觸發輸入
  31   2               CCF0 = 0;               //清除模組0的旗標
  32   2               i=CCAP0L-first ;  //捕捉CPA計數值
  33   2               LED=~i ;//將兩次CPA計數值的時間差(T)由LED輸出
  34   2         }    
  35   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    129    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
