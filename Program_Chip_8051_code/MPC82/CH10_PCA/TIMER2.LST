C51 COMPILER V9.03   TIMER2                                                                11/27/2011 14:46:04 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE TIMER2
OBJECT MODULE PLACED IN TIMER2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TIMER2.c OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /******TIMER2.C******PCA軟體計時中斷範例 ************
   2          *功能︰使用PCA軟體計時中斷，控制LED每秒反相一次
   3          *硬體：SW1-3(P0LED)ON
   4          ****************************************************/
   5          #include "..\MPC82.H" //暫存器及組態定義
   6          //Fosc=22.1184MHz，PCA計數時脈=Fosc/12=1.8432MHz
   7          #define T  14400  //軟體計時時間=(1/1.8432MHz)*14400=7812.5uS
   8          main()         
   9          {
  10   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  11   1        PCON2=7; //Fosc=Fosc/128，軟體計時時間=7812.5uS*128=1秒
  12   1        CMOD = 0;     //PCA計數時脈來源CPS1-0:00=Fosc/12
  13   1        CCAPM0 = ECOM+MAT+ECCF; //MAT=1，PAC計數與CCAP0匹配時，令CCF0=1
  14   1                                //ECOM=1，致能比較器功能
  15   1                                                        //ECCF=1，致能有匹配(CCF0=1)時，產生中斷
  16   1        CCAP0L = T;    //設定比較暫存器低位元組
  17   1        CCAP0H = T>>8; //設定比較暫存器高位元組
  18   1        EA = 1;        //致能所有中斷
  19   1        AUXIE = EPCA;  //致能PCA中斷
  20   1        CCF0 = 0;              //清除模組0的比較旗標
  21   1        CR = 1;        //啟動PCA計數 
  22   1        while(1);          //空轉,等待(CH:CL)=CCAP0產生中斷
  23   1       }
  24          /***********************************************************
  25          *函數名稱: PCA中斷函數
  26          *功能描述: 令LED反相閃爍
  27          ************************************************************/
  28          void PCA_Interrupt() interrupt 10
  29          {
  30   1        CCF0 = 0;         //清除模組0的比較旗標
  31   1        CL = CH =0;   //PCA計數器由0開始上數
  32   1        P0_0 = !P0_0; //LED反相閃爍     
  33   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     89    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
