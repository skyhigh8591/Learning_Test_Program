C51 COMPILER V8.17   LCD4                                                                  09/05/2009 14:18:32 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE LCD4
OBJECT MODULE PLACED IN LCD4.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LCD4.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //************* LCD4.C *********************
   2          //*動作：在文字型LCD上顯示"2007年07月15日
   3          //*******************************************
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5          char code mes[]="2009\00008\00115\002";//2008年08月15日
   6          char code Table[]={
   7           0x10,0x1f,0x02,0x0f,0x0a,0xff,0x02,0x00, //年
   8           0x0f,0x09,0x0f,0x09,0x0f,0x09,0x13,0x00, //月
   9           0x0f,0x09,0x09,0x0f,0x09,0x09,0x0f,0x00};//日
  10          main()
  11          {
  12   1        char i;                //陣列資料計數
  13   1        LCD_init();   //重置及清除LCD
  14   1        for(i=0x0;i<=23;i++) //寫入年月日字型 
  15   1         {
  16   2           LCD_Cmd(0x40+i);    //指定CGRAM位址  
  17   2           LCD_Data(Table[i]); //寫入CGRAM資料  
  18   2         } 
  19   1        LCD_Cmd(0x80);                 //指定第一行顯示               
  20   1        for(i=0;i<11;i++) LCD_Data(mes[i]);//顯示年月日
  21   1        while(1);      //停止
  22   1      }
  23          /***********************************************************
  24          *函數名稱: LCD_Data
  25          *功能描述: 傳送資料到文字型LCD
  26          *輸入參數：dat
  27          ************************************************************/
  28          void LCD_Data(unsigned char dat)  //傳送資料到LCD
  29          {
  30   1          unsigned char dly=3;
  31   1              Data=dat;      //資料送到BUS
  32   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  33   1          while(dly--);
  34   1              EN=0;          //禁能LCD 
  35   1              LCD_wait();    //LCD等待寫入完成  
  36   1      }
  37          /***************************************************************
  38          *函數名稱: LCD_Cmd
  39          *功能描述: 傳送命令到文字型LCD
  40          *輸入參數：Cmd
  41          ************************************************************/
  42          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  43          {
  44   1          unsigned char dly=3;
  45   1              Data=Cmd;       //命令送到BUS
  46   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  47   1          while(dly--);
  48   1          EN=0;           //禁能LCD
  49   1              LCD_wait(); //LCD等待寫入完成 
  50   1      }
  51          /***************************************************************
  52          *函數名稱: LCD_Cmd
  53          *功能描述: 傳送命令到文字型LCD
  54          *輸入參數：Cmd
  55          ************************************************************/
C51 COMPILER V8.17   LCD4                                                                  09/05/2009 14:18:32 PAGE 2   

  56          void LCD_Cmd_Init(unsigned char Cmd) //傳送命令到LCD
  57          {
  58   1              Data=Cmd;       //命令送到BUS
  59   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  60   1          Delay_ms(1);
  61   1          EN=0;           //禁能LCD
  62   1          Delay_ms(1);
  63   1      }
  64          /***************************************************************
  65          *函數名稱: LCD_init
  66          *功能描述: 啟始化文字型LCD
  67          *****************************************************************/
  68          void LCD_init(void)    //LCD的啟始程式  
  69          {
  70   1          LCD_Cmd_Init(0x38);//0011 1000,8bit傳輸,顯示2行,5*7字型
  71   1          LCD_Cmd_Init(0x38);//bit4:DL=1,8bit傳輸,
  72   1          LCD_Cmd_Init(0x38);//bit3:N=1,顯示2行
  73   1                             //bit2:F=0,5*7字型    
  74   1          LCD_Cmd_Init(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  75   1                          bit2:D=1,顯示幕ON
  76   1                          bit1:C=0,不顯示游標
  77   1                              bit0:B=0,游標不閃爍*/
  78   1          LCD_Cmd_Init(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  79   1                          bit1:I/D=1,顯示完游標右移,
  80   1                          bit0:S=0,游標移位禁能*/  
  81   1          LCD_Cmd_Init(0x01); //清除顯示幕  
  82   1          LCD_Cmd_Init(0x02); //游標回原位  
  83   1      }
  84          /**************************************************
  85          *函數名稱: LCD_wait
  86          *功能描述: LCD等待忙碌旗標BF
  87          ****************************************************/
  88          void LCD_wait(void)
  89          {
  90   1        unsigned char status;  //定義LCD讀取狀態
  91   1        Data=0xff; //P0設定為輸入埠
  92   1        do
  93   1        {
  94   2          RS=0;RW=1;EN=1;//讀取命令
  95   2          status= Data;       //輸入LCD的命令
  96   2          EN=0;                       //禁能LCD
  97   2        }
  98   1        while(status & 0x80); //等待忙碌旗標BF=0
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    280    ----
   CONSTANT SIZE    =     36    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
