C51 COMPILER V8.17   CALENDAR1                                                             09/05/2009 16:34:43 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE CALENDAR1
OBJECT MODULE PLACED IN calendar1.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE calendar1.c OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //************* calendar1.c *************************************
   2          //動作：以計時中斷，在LCD顯示電子鐘時、分、秒
   3          //*************************************************************
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5          
   6                            //Fosc=22.1184MHz，Timer時脈=Fosc/12=1.8432MHz
   7          #define T  57599  //Timer延時時間=(1/1.8432MHz)*57600=31250uS
   8           unsigned char dly_sec=32; //設定計時重覆次數，時間=31250uS*32=1秒
   9           unsigned char hor=13,min=32,sec=55;  //設定時、分秒初值        
  10          
  11          main()
  12          {
  13   1         EA=1;ET1=1; //致能Timet1計時溢位中斷
  14   1         TMOD=0x10;  //設定Timer1為mode1內部計時
  15   1         TR1=1;      //啟動Timer1
  16   1                                                  
  17   1         LCD_init();           //重置及清除LCD 
  18   1      
  19   1         while(1)       //開始顯示及計算萬年曆
  20   1         {    
  21   2                LCD_Cmd(0x80);        //顯示第一行位置
  22   2            LCD_Data(hor/10+'0');LCD_Data(hor%10+'0'); //顯示時
  23   2            LCD_Data(':');
  24   2                 
  25   2                LCD_Data(min/10+'0');LCD_Data(min%10+'0'); //顯示分
  26   2            LCD_Data(':');
  27   2          
  28   2            LCD_Data(sec/10+'0'); LCD_Data(sec%10+'0');//顯示秒
  29   2      
  30   2            if (sec < 60) continue; //若秒小於60到while(1)處   
  31   2            sec=0; min++;           //秒等於60則令秒=0，分加一
  32   2            
  33   2                if (min < 60) continue; //若分小於60到while(1)處   
  34   2            min=0; hor++;           //若分等於60則令分=0，時加一
  35   2            
  36   2                if (hor <24)  continue; //若時小於24到while(1)處
  37   2            hor=0; min=0; sec=0;    //若時等於24則令時、分、秒=0 
  38   2        }
  39   1      }
  40          /*******************************************************/ 
  41          void T1_int(void) interrupt 3  //Timer1中斷函數
  42          {
  43   1        TL1= (65536-T) % 256; //將低8-bit計數值存入TL1 
  44   1        TH1= (65536-T) / 256; //將高8-bit計數值存入TH1 
  45   1        dly_sec--;            //計時重覆次數遞減
  46   1        if(dly_sec==0)        //若秒時間到
  47   1         { NOP();sec++; dly_sec=32;}//秒遞加及設定計時重覆次數
  48   1        TF1=0;                //清除計時溢位TF1=0
  49   1      }
  50          /***********************************************************
  51          *函數名稱: LCD_Data
  52          *功能描述: 傳送資料到文字型LCD
  53          *輸入參數：dat
  54          ************************************************************/
  55          void LCD_Data(char dat)  //傳送資料到LCD
C51 COMPILER V8.17   CALENDAR1                                                             09/05/2009 16:34:43 PAGE 2   

  56          {
  57   1          Data=dat; //資料送到BUS
  58   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  59   1          Delay_ms(1);   //LCD等待寫入完成
  60   1          EN=0;          //禁能LCD    
  61   1      }
  62          /***************************************************************
  63          *函數名稱: LCD_Cmd
  64          *功能描述: 傳送命令到文字型LCD
  65          *輸入參數：Cmd
  66          ************************************************************/
  67          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  68          {
  69   1          Data=Cmd;  //命令送到BUS
  70   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  71   1          Delay_ms(1);    //LCD等待寫入完成     
  72   1          EN=0;           //禁能LCD
  73   1      }
  74          /***************************************************************
  75          *函數名稱: LCD_init
  76          *功能描述: 啟始化文字型LCD
  77          *****************************************************************/
  78          void LCD_init(void)    //LCD的啟始程式  
  79          {
  80   1          LCD_Cmd(0x38);/*0011 1000,8bit傳輸,顯示2行,5*7字型
  81   1                          bit4:DL=1,8bit傳輸,
  82   1                          bit3:N=1,顯示2行
  83   1                          bit2:F=0,5*7字型*/    
  84   1          LCD_Cmd(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  85   1                          bit2:D=1,顯示幕ON
  86   1                          bit1:C=0,不顯示游標
  87   1                              bit0:B=0,游標不閃爍*/
  88   1          LCD_Cmd(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  89   1                          bit1:I/D=1,顯示完游標右移,
  90   1                          bit0:S=0,游標移位禁能*/  
  91   1          LCD_Cmd(0x01); //清除顯示幕  
  92   1          LCD_Cmd(0x02); //游標回原位  
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    299    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
