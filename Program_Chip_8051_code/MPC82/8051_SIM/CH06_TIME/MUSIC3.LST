C51 COMPILER V8.17   MUSIC3                                                                02/20/2009 06:57:03 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE MUSIC3
OBJECT MODULE PLACED IN MUSIC3.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MUSIC3.c OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********MUSIC3.c**** 電子琴範例**********
   2          *動作：按鍵0~9，令喇叭輸出各種音頻
   3          *硬體：SW2-5(SPK)ON，按鍵S1~S10
   4          ************************************************/
   5          #include "..\MPC82.H"   //暫存器及組態定義
   6          #include "music.h"  //音頻定義
   7          void dataout(char keyout);    //按鍵輸出
   8          
   9          unsigned int  code Table[] //音頻的列表資料，按鍵0~9的音頻  
  10                 = {SI2,DO3,RE3,MI3,FA3,SO3,LA3,SI3,DO4,RE4};
  11          unsigned char   i=0;    //資料計數
  12          void main()
  13          {
  14   1         unsigned char count=0;  //按鍵計數
  15   1         unsigned char scan=0xEF;  //按鍵掃描令ROW0=0，其餘為1
  16   1         
  17   1         TMOD=0x01;   //設定Timer0為mode1內部計時 
  18   1         EA=1;ET0=1;  //致能Timer0中斷
  19   1       
  20   1        while(1)   //重覆執行
  21   1        {
  22   2          if(count>15){scan=0xEF;count=0;}//若計數>15，從頭開始
  23   2          ROW=scan;     //掃描輸出
  24   2          if(COL0==0) dataout(count);//檢查COL0列，若是計數輸出
  25   2          count++; Delay_ms(1);      //若不是，計數+1
  26   2          if(COL1==0) dataout(count);//檢查COL1列，若是計數輸出
  27   2          count++; Delay_ms(1);      //若不是，計數+1
  28   2          if(COL2==0) dataout(count);//檢查COL2列，若是計數輸出
  29   2          count++; Delay_ms(1);      //若不是，計數+1
  30   2          if(COL3==0) dataout(count);//檢查COL3列，若是計數輸出
  31   2          count++; Delay_ms(1);      //若不是，計數+1
  32   2          scan=RL8(scan); //左旋轉，換掃下一列,令ROW0~3輪流為0
  33   2        }
  34   1      }
  35          /***********************************************************
  36          *函數名稱: dataout
  37          *功能描述: 按鍵讀取音頻資料發出聲音，檢查是否放開按鍵
  38          *輸入參數：keyout
  39          ************************************************************/
  40          void dataout(char keyout) 
  41          {       
  42   1          i=keyout; //按鍵計數存入資料計數
  43   1              TL0=Table[i];TH0=Table[i] >>8; //設定計時值     
  44   1          TR0=1;             //啟動Timer0開始計時, 發出聲音
  45   1          Delay_ms(1);        //處理按鍵跳動之延遲   
  46   1          while(!(COL0 & COL1 & COL2 & COL3));//若COL0~3≠1111未放開按鍵
  47   1          Delay_ms(1);        //處理按鍵跳動之延遲
  48   1          TR0=0;              //停止Timer0計時，停止輸出音頻 
  49   1      }
  50          /***************************************/
  51          void T0_int(void) interrupt 1  //Timer0中斷函數
  52          {
  53   1        TL0=Table[i]; TH0=Table[i] >>8; //重新設定計時值
  54   1        SPEAK=!SPEAK;     //喇叭反相輸出
  55   1      }
C51 COMPILER V8.17   MUSIC3                                                                02/20/2009 06:57:03 PAGE 2   

  56          
  57           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    323    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
