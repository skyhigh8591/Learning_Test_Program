C51 COMPILER V9.56.0.0   UART5                                                             03/13/2020 15:33:12 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE UART5
OBJECT MODULE PLACED IN UART5.OBJ
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE UART5.C OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**********UART5.C ******UART與LCD傳輸**********
   2          *動作：接收個人電腦的資料，送到LCD顯示
   3          *硬體：SW3-4(RxD1)ON
   4          ************************************************/
   5          #include "..\MPC82.H"   //暫存器及組態定義
   6          char code Table1[] = "COUNT="; //第一行陣列字元
   7          char j=0;
   8          main()
   9          {   
  10   1        char i;         //計數值
  11   1        LCD_init();     //LCD啟始程式
  12   1        LCD_Cmd(0x80);        //游標由第一行開始顯示     
  13   1        for(i=0 ; i< 6 ; i++)   
  14   1            LCD_Data(Table1[i]);//讀取陣列文字送到LCD顯示      
  15   1          LCD_Cmd(0x0f);//*0000 1111,顯示幕ON,顯示游標,游標閃爍
  16   1        LCD_Cmd(0x86);        //游標由第一行第6字開始顯示 
  17   1               
  18   1        UART_init(9600);      //設定串列環境及鮑率   
  19   1        EA=1;ES=1;            //致能串列中斷   
  20   1        while(1);     //自我空轉，表示可做其它工作
  21   1      }
  22          /*****************************************************/
  23          void SCON_int(void)  interrupt 4  //串列中斷函數  
  24          {  
  25   1        RI=0;             //接收完畢，令RI=0      
  26   1        LCD_Data(SBUF);  //將接收到的字元由LCD顯示    
  27   1        if(j==3) LCD_Cmd(0x86); //若輸入最後一個字，游標回前面
  28   1        j++;
  29   1        if(j>3) j=0;//在LCD只能輸入4個字
  30   1      }
  31          /***********************************************************
  32          *函數名稱: UART_init
  33          *功能描述: UART啟始程式
  34          *輸入參數：bps
  35          ************************************************************/
  36          void UART_init(unsigned int bps)  //UART啟始程式
  37          {  P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  38   1         SCON = 0x50;     //設定UART串列傳輸為MODE1及致能接收
  39   1         TMOD = 0x20;     //設定TIMER1為MODE2
  40   1         TH1 = 256-(57600/bps);  //設計時器決定串列傳輸鮑率
  41   1         TR1 = 1;          //開始計時
  42   1      }
  43          /***********************************************************
  44          *函數名稱: LCD_Data
  45          *功能描述: 傳送資料到文字型LCD
  46          *輸入參數：dat
  47          ************************************************************/
  48          void LCD_Data(char dat)  //傳送資料到LCD
  49          {
  50   1        Data=dat; //資料送到BUS   
  51   1        P0_7=0;    //過濾顯示字型資料
  52   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  53   1          Delay_ms(1);   //LCD等待寫入完成
  54   1          EN=0;          //禁能LCD    
  55   1      }
C51 COMPILER V9.56.0.0   UART5                                                             03/13/2020 15:33:12 PAGE 2   

  56          /***************************************************************
  57          *函數名稱: LCD_Cmd
  58          *功能描述: 傳送命令到文字型LCD
  59          *輸入參數：Cmd
  60          ************************************************************/
  61          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  62          {
  63   1          Data=Cmd;  //命令送到BUS
  64   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  65   1          Delay_ms(1);    //LCD等待寫入完成     
  66   1          EN=0;           //禁能LCD
  67   1      }
  68          /***************************************************************
  69          *函數名稱: LCD_init
  70          *功能描述: 啟始化文字型LCD
  71          *****************************************************************/
  72          void LCD_init(void)    //LCD的啟始程式  
  73          {
  74   1          LCD_Cmd(0x38);/*0011 1000,8bit傳輸,顯示2行,5*7字型
  75   1                          bit4:DL=1,8bit傳輸,
  76   1                          bit3:N=1,顯示2行
  77   1                          bit2:F=0,5*7字型*/    
  78   1          LCD_Cmd(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  79   1                          bit2:D=1,顯示幕ON
  80   1                          bit1:C=0,不顯示游標
  81   1                        bit0:B=0,游標不閃爍*/
  82   1          LCD_Cmd(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  83   1                          bit1:I/D=1,顯示完游標右移,
  84   1                          bit0:S=0,游標移位禁能*/  
  85   1          LCD_Cmd(0x01); //清除顯示幕  
  86   1          LCD_Cmd(0x02); //游標回原位  
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    271    ----
   CONSTANT SIZE    =      7    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
