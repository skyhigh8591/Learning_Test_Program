C51 COMPILER V9.56.0.0   LCD5                                                              03/04/2020 15:23:35 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCD5
OBJECT MODULE PLACED IN LCD5.OBJ
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE LCD5.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /****** LCD5.C ******* LCD顯示中文字型範例*******
   2          *動作：由LCD顯示自創的資工字型 
   3          ***********************************************/
   4          #include "..\MPC82.H"   //暫存器及組態定義
   5          unsigned char code Table[]=   //自創資工字型
   6           {0x00,0x00,0x19,0x02,0x08,0x11,0x07,0x04,//資的左上字
   7            0x00,0x10,0x1f,0x09,0x14,0x02,0x1c,0x04,//資的右上字
   8            0x00,0x0f,0x00,0x00,0x00,0x00,0x01,0x01,//工的左上字
   9            0x00,0x1e,0x08,0x08,0x10,0x10,0x00,0x00,//工的右上字
  10            0x07,0x04,0x07,0x04,0x07,0x02,0x04,0x00,//資的左下字
  11            0x1c,0x04,0x1c,0x04,0x1c,0x08,0x04,0x00,//資的右下字
  12            0x00,0x00,0x00,0x01,0x02,0x02,0x1f,0x00,//工的左下字
  13            0x10,0x10,0x10,0x00,0x00,0x00,0x1f,0x00 //工的右下字
  14           };
  15          main()
  16          {   
  17   1        unsigned char i;   
  18   1          LCD_init();             //重置及清除LCD     
  19   1          for(i=0x0;i<=0x3f;i++) //寫入CGRAM位址
  20   1           {
  21   2             LCD_Cmd(0x40+i);    //指定CGRAM位址  
  22   2             LCD_Data(Table[i]); //寫入CGRAM資料  
  23   2           }        
  24   1          LCD_Cmd(0x80);  //指定第一行顯示的位址
  25   1          for(i=0;i<4;i++)   LCD_Data(i);//讀取CGROM位址0-3的自創圖形資料    
  26   1           LCD_Cmd(0xc0); //指定第二行顯示的位址
  27   1          for(i=4;i<8;i++)  LCD_Data(i);  //讀取CGROM位址4-7的自創圖形資料   
  28   1         while(1);  //停止
  29   1       } 
  30          /***********************************************************
  31          *函數名稱: LCD_Data
  32          *功能描述: 傳送資料到文字型LCD
  33          *輸入參數：dat
  34          ************************************************************/
  35          void LCD_Data(unsigned char dat)  //傳送資料到LCD
  36          {
  37   1          unsigned char dly=5;
  38   1        Data=dat;      //資料送到BUS
  39   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  40   1          while(dly--);
  41   1        EN=0;          //禁能LCD 
  42   1        LCD_wait();    //LCD等待寫入完成  
  43   1      }
  44          /***************************************************************
  45          *函數名稱: LCD_Cmd
  46          *功能描述: 傳送命令到文字型LCD
  47          *輸入參數：Cmd
  48          ************************************************************/
  49          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  50          {
  51   1          unsigned char dly=5;
  52   1        Data=Cmd;       //命令送到BUS
  53   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  54   1          while(dly--);
  55   1          EN=0;           //禁能LCD
C51 COMPILER V9.56.0.0   LCD5                                                              03/04/2020 15:23:35 PAGE 2   

  56   1        LCD_wait(); //LCD等待寫入完成 
  57   1      }
  58          /***************************************************************
  59          *函數名稱: LCD_Cmd
  60          *功能描述: 傳送命令到文字型LCD
  61          *輸入參數：Cmd
  62          ************************************************************/
  63          void LCD_Cmd_Init(unsigned char Cmd) //傳送命令到LCD
  64          {
  65   1        Data=Cmd;       //命令送到BUS
  66   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  67   1          Delay_ms(1);
  68   1          EN=0;           //禁能LCD
  69   1          Delay_ms(1);
  70   1      }
  71          /***************************************************************
  72          *函數名稱: LCD_init
  73          *功能描述: 啟始化文字型LCD
  74          *****************************************************************/
  75          void LCD_init(void)    //LCD的啟始程式  
  76          {
  77   1          LCD_Cmd_Init(0x38);//0011 1000,8bit傳輸,顯示2行,5*7字型
  78   1          LCD_Cmd_Init(0x38);//bit4:DL=1,8bit傳輸,
  79   1          LCD_Cmd_Init(0x38);//bit3:N=1,顯示2行
  80   1                             //bit2:F=0,5*7字型    
  81   1          LCD_Cmd_Init(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
  82   1                          bit2:D=1,顯示幕ON
  83   1                          bit1:C=0,不顯示游標
  84   1                        bit0:B=0,游標不閃爍*/
  85   1          LCD_Cmd_Init(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
  86   1                          bit1:I/D=1,顯示完游標右移,
  87   1                          bit0:S=0,游標移位禁能*/  
  88   1          LCD_Cmd_Init(0x01); //清除顯示幕  
  89   1          LCD_Cmd_Init(0x02); //游標回原位  
  90   1      }
  91          /**************************************************
  92          *函數名稱: LCD_wait
  93          *功能描述: LCD等待忙碌旗標BF
  94          ****************************************************/
  95          void LCD_wait(void)
  96          {
  97   1        unsigned char status;  //定義LCD讀取狀態
  98   1        Data=0xff; //P0設定為輸入埠
  99   1        do
 100   1        {
 101   2          RS=0;RW=1;EN=1;//讀取命令
 102   2          status= Data; //輸入LCD的命令
 103   2          EN=0;     //禁能LCD
 104   2        }
 105   1        while(status & 0x80); //等待忙碌旗標BF=0
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    270    ----
   CONSTANT SIZE    =     64    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.56.0.0   LCD5                                                              03/04/2020 15:23:35 PAGE 3   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
