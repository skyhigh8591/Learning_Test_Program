C51 COMPILER V9.03   ENCODE1                                                               11/27/2011 16:19:26 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE ENCODE1
OBJECT MODULE PLACED IN ENCODE1.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ENCODE1.C OPTIMIZE(2,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********** ENCODE1.c ********一倍解析編碼器實習範例***************
   2          *動作：將ENCODE旋轉時所產生的A、B相信號，送到捕捉器CEX4(P16)
   3                 及P17作為觸發輸入信號，在LED顯示馬達正反轉數值
   4          *硬體：SW1-3(P0LED)ON。由P12及P13模擬ENCODE信號，
   5          *      連接(或反接)P16及P17，可改變LED上/下數。
   6          *      或在J9連接ENCODE，正/反旋轉，可改變LED上/下數 
   7          ***********************************************************/
   8          #include "..\MPC82.H"  //暫存器及組態定義
   9          unsigned int count=0;  //ENCODE計數值
  10          main()          
  11          {
  12   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  13   1        EA = 1; AUXIE = EPCA; //致能PCA中斷
  14   1        CCF4 = 0;        //清除模組4的比較旗標
  15   1        CCAPM4 = ECCF+CAPN; //CEX4(P16)負觸發輸入時，產生中斷
  16   1        CR = 1;        //啟動PCA計數 
  17   1        LED=~count;   //計數由LED輸出
  18   1      
  19   1        P1_2=P1_3=0;  //模擬ENCODE的動作
  20   1        while(1)
  21   1        {
  22   2         P1_2=1; Delay_ms(500);
  23   2         P1_3=1; Delay_ms(500);
  24   2         P1_2=0; Delay_ms(500);
  25   2         P1_3=0; Delay_ms(500);
  26   2        }  
  27   1      }
  28          /***********************************************************
  29          *函數名稱: PCA中斷函數
  30          *功能描述: 自動令CEX0反相
  31          ************************************************************/
  32          void PCA_Interrupt() interrupt 10
  33          {
  34   1        CF=0;                 //清除PCA計數溢位旗標
  35   1        CCF4 = 0;         //清除模組4的比較旗標
  36   1        if(P1_7) count++; //若正轉，計數遞加
  37   1          else count--;   //若反轉，計數遞減
  38   1        LED=~count;       //計數由LED輸出
  39   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
