C51 COMPILER V8.17   LCD6                                                                  09/05/2009 14:38:41 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE LCD6
OBJECT MODULE PLACED IN LCD6.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LCD6.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****************** LCD顯示自創圖形範例***********
   2          *檔名：LCD6.C
   3          *動作：自創4個圖形，並令LCD顯示小綠人動畫 
   4          ********************************************************/
   5          #include "..\MPC82.H"   //暫存器及組態定義
   6          unsigned char  code Table[]= {   //自創5個小綠人圖形
   7             0x00,0x0c,0x1e,0x0c,0x06,0x07,0x07,0x0b, //圖0左上(向左行步1)
   8             0x00,0x00,0x00,0x00,0x00,0x18,0x04,0x02, //圖0右上
   9             0x11,0x01,0x01,0x01,0x06,0x1e,0x10,0x00, //圖0左下
  10             0x10,0x10,0x08,0x06,0x03,0x01,0x01,0x00, //圖0右下
  11                   
  12             0x00,0x0c,0x1e,0x0c,0x06,0x07,0x06,0x03, //圖1左上(向左行步2)
  13             0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x08, //圖1右上
  14             0x03,0x05,0x03,0x04,0x04,0x03,0x0f,0x00, //圖1左下
  15             0x08,0x10,0x10,0x10,0x08,0x06,0x0c,0x00, //圖1右下
  16                   
  17             0x00,0x00,0x00,0x00,0x00,0x03,0x04,0x08, //圖2左上(向右行步1)
  18             0x00,0x06,0x0f,0x06,0x0c,0x1c,0x1c,0x1a, //圖2右上
  19             0x01,0x01,0x02,0x0c,0x18,0x10,0x10,0x00, //圖2左下
  20             0x11,0x10,0x10,0x10,0x0c,0x0f,0x01,0x00, //圖2右下
  21          
  22             0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02, //圖3左上(向行步右2)
  23             0x00,0x06,0x0f,0x06,0x0c,0x1c,0x0c,0x18, //圖3右上
  24             0x02,0x01,0x01,0x01,0x02,0x0c,0x06,0x00, //圖3左下
  25             0x18,0x14,0x18,0x04,0x04,0x18,0x1e,0x00, //圖3右下
  26            };
  27           
  28           void DISPLAY(unsigned char i);  //在指定i位置  
  29           void write(unsigned char word);   //寫入指定字型資料到CGRAM
  30           //*************************************************
  31          void main(void)
  32          {
  33   1         unsigned char shift;
  34   1         LCD_init();          // 重置及清除LCD  
  35   1         while(1)
  36   1         {     
  37   2           for(shift=14;shift>0;shift=shift-2)  // 由右向左移位
  38   2           {
  39   3           write(32*0);  DISPLAY(shift);       // 寫入圖0，移位顯示
  40   3           write(32*1);  DISPLAY(shift-1);      // 寫入圖1，移位顯示
  41   3           }
  42   2            for(shift=0;shift<14;shift=shift+2) // 由左向右移位
  43   2           {
  44   3           write(32*2);  DISPLAY(shift);        // 寫入圖2，移位顯示
  45   3           write(32*3);  DISPLAY(shift+1);      // 寫入圖3，移位顯示
  46   3           }
  47   2         }
  48   1      }
  49          //*************************************************
  50          void write(unsigned char word)          // 寫入指定圖形資料到CGRAM 
  51          {
  52   1        unsigned char addr;
  53   1        for (addr=0x0;addr<=0x1f;addr++)  // 寫入位址
  54   1         {
  55   2           LCD_Cmd(0x40+addr);        // 指定CGRAM位址  
C51 COMPILER V8.17   LCD6                                                                  09/05/2009 14:38:41 PAGE 2   

  56   2           LCD_Data(Table[addr+word]);// 寫入指定圖形資料到CGRAM
  57   2         } 
  58   1      }
  59          //*************************************************
  60          void DISPLAY(unsigned char i) // 指定移位的位置，顯示自造圖形 
  61          {
  62   1        unsigned char count;
  63   1        LCD_Cmd(0x80+i);      // 指定第一行i位置顯示
  64   1        for(count=0;count<2;count++)  
  65   1           LCD_Data(count);   // 讀取CGROM位址0-1(圖上)顯示
  66   1          
  67   1        LCD_Cmd(0xc0+i);      // 指定第二行i位置顯示
  68   1        for(count=2;count<4;count++)
  69   1           LCD_Data(count);   // 讀取CGROM位址2-3(圖下)顯示
  70   1       
  71   1        Delay_ms(100);    // 延時，圖形停滯時間
  72   1        LCD_Cmd(0x01);LCD_Cmd(0x02);//清除顯示幕 
  73   1      }
  74          /***********************************************************
  75          *函數名稱: LCD_Data
  76          *功能描述: 傳送資料到文字型LCD
  77          *輸入參數：dat
  78          ************************************************************/
  79          void LCD_Data(unsigned char dat)  //傳送資料到LCD
  80          {
  81   1          unsigned char dly=5;
  82   1              Data=dat;      //資料送到BUS
  83   1          RS=1;RW=0;EN=1;//資料寫入到LCD內
  84   1          while(dly--);
  85   1              EN=0;          //禁能LCD 
  86   1              LCD_wait();    //LCD等待寫入完成  
  87   1      }
  88          /***************************************************************
  89          *函數名稱: LCD_Cmd
  90          *功能描述: 傳送命令到文字型LCD
  91          *輸入參數：Cmd
  92          ************************************************************/
  93          void LCD_Cmd(unsigned char Cmd) //傳送命令到LCD
  94          {
  95   1          unsigned char dly=5;
  96   1              Data=Cmd;       //命令送到BUS
  97   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
  98   1          while(dly--);
  99   1          EN=0;           //禁能LCD
 100   1              LCD_wait(); //LCD等待寫入完成 
 101   1      }
 102          /***************************************************************
 103          *函數名稱: LCD_Cmd
 104          *功能描述: 傳送命令到文字型LCD
 105          *輸入參數：Cmd
 106          ************************************************************/
 107          void LCD_Cmd_Init(unsigned char Cmd) //傳送命令到LCD
 108          {
 109   1              Data=Cmd;       //命令送到BUS
 110   1          RS=0;RW=0;EN=1; //命令寫入到LCD內
 111   1          Delay_ms(1);
 112   1          EN=0;           //禁能LCD
 113   1          Delay_ms(1);
 114   1      }
 115          /***************************************************************
 116          *函數名稱: LCD_init
 117          *功能描述: 啟始化文字型LCD
C51 COMPILER V8.17   LCD6                                                                  09/05/2009 14:38:41 PAGE 3   

 118          *****************************************************************/
 119          void LCD_init(void)    //LCD的啟始程式  
 120          {
 121   1          LCD_Cmd_Init(0x38);//0011 1000,8bit傳輸,顯示2行,5*7字型
 122   1          LCD_Cmd_Init(0x38);//bit4:DL=1,8bit傳輸,
 123   1          LCD_Cmd_Init(0x38);//bit3:N=1,顯示2行
 124   1                             //bit2:F=0,5*7字型    
 125   1          LCD_Cmd_Init(0x0c);/*0000 1100,顯示幕ON,不顯示游標,游標不閃爍
 126   1                          bit2:D=1,顯示幕ON
 127   1                          bit1:C=0,不顯示游標
 128   1                              bit0:B=0,游標不閃爍*/
 129   1          LCD_Cmd_Init(0x06);/*0000 0110,//顯示完游標右移,游標移位禁能 
 130   1                          bit1:I/D=1,顯示完游標右移,
 131   1                          bit0:S=0,游標移位禁能*/  
 132   1          LCD_Cmd_Init(0x01); //清除顯示幕  
 133   1          LCD_Cmd_Init(0x02); //游標回原位  
 134   1      }
 135          /**************************************************
 136          *函數名稱: LCD_wait
 137          *功能描述: LCD等待忙碌旗標BF
 138          ****************************************************/
 139          void LCD_wait(void)
 140          {
 141   1        unsigned char status;  //定義LCD讀取狀態
 142   1        Data=0xff; //P0設定為輸入埠
 143   1        do
 144   1        {
 145   2          RS=0;RW=1;EN=1;//讀取命令
 146   2          status= Data;       //輸入LCD的命令
 147   2          EN=0;                       //禁能LCD
 148   2        }
 149   1        while(status & 0x80); //等待忙碌旗標BF=0
 150   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    378    ----
   CONSTANT SIZE    =    128    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
