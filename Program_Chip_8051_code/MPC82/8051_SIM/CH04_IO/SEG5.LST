C51 COMPILER V8.17   SEG5                                                                  09/02/2009 15:55:47 PAGE 1   


C51 COMPILER V8.17, COMPILATION OF MODULE SEG5
OBJECT MODULE PLACED IN SEG5.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SEG5.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********** SEG5.C ***********************************
   2          *動作：手動控制步進馬達運轉，同時在七段顯示器顯示步數 
   3          *接線：Data=七段顯示器低電位輸出=Pgfedcba
   4          *      低電位掃描：S3~0=千、百、十、個位數                            
   5          *      矩陣式按鍵(0)P20=控制正反轉，1=正轉，0=反轉。
   6          *      矩陣式按鍵(1)P21=控制運轉/停止，1=運轉，0=停止
   7          *      矩陣式按鍵(2)P22=控制加速，1=不變，0=加速
   8          *      矩陣式按鍵(3)P23=控制減速，1=不變，0=減速
   9          *硬體：SW1-1(SEG7)及SW2-1~4(STEP)ON,按鍵(0)~(3)
  10          ******************************************************/
  11          #include "..\MPC82.H"   //暫存器及組態定義
  12          code char run_Table[] = {0x01,0x02,0x04,0x08}; //步進馬達驅動數碼 
  13          code unsigned char Table[] //七段顯示器0~9數碼資料
  14          ={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  15          int step=0;  //步進馬達行進步數=0
  16          void Display(char scan); //七段顯示器顯示步數
  17          void main()
  18          {
  19   1        int scan=100; //四位數七段顯示器掃描次數
  20   1        char  i=0;  //步進馬達驅動數碼計數=0
  21   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  22   1        P1M0=0; P1M1=0xF0; //設定P17-4(STEP)為推挽式輸出(M0-1=01)
  23   1        STEP=0x0f;    //步進馬達輸出=0  
  24   1        P2_4=0;  //選擇按鍵(0)~(3)
  25   1        while(1) 
  26   1         {
  27   2          Display(scan);     //七段顯示器顯示步數
  28   2          while(P2_1==0) Display(scan); //若P21=0停止運轉，掃描顯示器
  29   2              if(P2_0==1)          //若P21=1，P20=1，馬達正轉
  30   2           {
  31   3            if(i>3) i=0;     //若資料計數>3，從0開始
  32   3                STEP=run_Table[i]<<4; //讀取驅動數碼由STEP輸出 
  33   3            i++; step++;     //資料計數+1及步數+1
  34   3                if(step > 9999) step=0;
  35   3           }
  36   2          else               //若P21=1，P20=0，馬達反轉
  37   2          {
  38   3            if(i<0) i=3;     //若資料計數<0，從3開始
  39   3            STEP=run_Table[i]<<4; //讀取驅動數碼由STEP輸出  
  40   3            i--; step--;     //資料計數-1及步數-1 
  41   3                if(step < 0) step=9999;
  42   3          }
  43   2      
  44   2              if(P2_2==0){scan--;if(scan< 10) scan=10;}//P22=0加速，限制加速
  45   2              if(P2_3==0){scan++;if(scan > 999) scan=999;}//P23=0減速，限制減速
  46   2        }
  47   1      }
  48          //***************************************************    
  49          void Display(char scan) //四位數七段顯示器顯示步數       
  50          {  
  51   1        unsigned char i; //七段顯示器數碼資料計數
  52   1        while(scan--) //重覆掃描次數 
  53   1         {
  54   2           S0=S1=S2=S3=1; //遮沒
  55   2           i=step % 10;   //取出個位數
C51 COMPILER V8.17   SEG5                                                                  09/02/2009 15:55:47 PAGE 2   

  56   2           Data=~Table[i]; //讀取個位數碼資料輸出
  57   2           S0=0;        //選擇個位數顯示器
  58   2           Delay_ms(1);    //掃描延時  
  59   2             
  60   2               S0=S1=S2=S3=1; //遮沒           
  61   2           i=(step % 100)/10; //取出十位數 
  62   2           Data=~Table[i];//讀取十位數碼資料輸出
  63   2           S1=0;       //選擇十位數顯示器
  64   2           Delay_ms(1);   //掃描延時
  65   2                                  
  66   2           S0=S1=S2=S3=1; //遮沒
  67   2               i=(step % 1000)/100; //取出百位數
  68   2           Data=~Table[i]; //讀取百位數碼資料輸出
  69   2           S2=0;       //選擇百位數顯示器
  70   2           Delay_ms(1);    //掃描延時
  71   2             
  72   2               S0=S1=S2=S3=1; //遮沒
  73   2           i=step/1000;  //取出千位數
  74   2           Data=~Table[i]; //讀取千位數碼資料輸出
  75   2           S3=0;        //選擇千位數顯示器
  76   2           Delay_ms(1);    //掃描延時
  77   2         } 
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    501    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
