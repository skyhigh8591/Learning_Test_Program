C51 COMPILER V9.03   CAP3                                                                  11/27/2011 16:09:42 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE CAP3
OBJECT MODULE PLACED IN CAP3.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE CAP3.c OPTIMIZE(2,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********** CAP3.c ********捕捉器中斷實習範例***************
   2          *動作：令Timer2由T2CKO(P10)輸出方波,送到CEX0(P12)捕捉輸入
   3          *      ，在LED顯示時間差
   4          *硬體：SW1-3(P0LED)ON，將T2CKO(P10)連接到CEX0(P12)
   5          ***********************************************************/
   6          #include "..\MPC82.H"  //暫存器及組態定義
   7          #define T 0x56 //T2CKO頻率=Fosc/4/(65536-T2)=22118400/4/T                           
   8            unsigned int old=0;   //第一次CCAP0捕捉時間
   9          
  10          main()          
  11          {
  12   1        P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  13   1        T2CON=0x00; /* 0000 0000，設定為內部計時，溢位重新載入
  14   1                       bit3:EXEN2=0,不使用外部T2EX接腳
  15   1                                   bit1:C/T2=0,內部計時 */
  16   1        RCAP2=T2R=65536-T; //設定Timer2及重新載入時間
  17   1        TR2=1;        //啟動Timer2開始計時
  18   1        T2MOD=T2CKOE; //致能T2CKO(P10)輸出方波
  19   1        
  20   1        EA = 1; AUXIE = EPCA; //致能PCA中斷
  21   1        CCF0 = 0;        //清除模組0的比較旗標
  22   1        CMOD = CPS0; //PCA時脈來源:CPS1-0:01=Fosc/2,配合T2CKO=Fosc/4/(65536-T2)
  23   1        CCAPM0 = CAPP+CAPN+ECCF; //CAPP=1，正緣觸發輸入時，CCAP0<--CH:CL)
  24   1        CR = 1;        //啟動PCA計數 
  25   1        while(1);
  26   1      }
  27          /***********************************************************
  28          *函數名稱: PCA中斷函數
  29          *功能描述: 自動令CEX0反相
  30          ************************************************************/
  31          void PCA_Interrupt() interrupt 10
  32          {
  33   1        CF=0;                 //清除PCA計數溢位旗標
  34   1        CCF0 = 0;         //清除模組0的比較旗標
  35   1        if((CCAP0L-old)>0) //捕捉CPA計數值
  36   1          LED=~(CCAP0L-old) ; //將兩次CPA計數值的時間差(T)由LED輸出
  37   1        old=CCAP0L;
  38   1      
  39   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    154    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
