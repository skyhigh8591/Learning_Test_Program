C51 COMPILER V9.56.0.0   UART4A                                                            03/13/2020 15:29:31 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE UART4A
OBJECT MODULE PLACED IN UART4A.OBJ
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE UART4A.C OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /********** UART4A.c ********MODE1串列中斷接收****************
   2          *動作：電腦UART送出字元，由RXD腳以中斷接收，來切換點矩陣LED字型
   3          *硬體：SW1-2(LED8X8)、SW3-3(TxD1)及SW3-4(RxD1)ON
   4          *操作：在超級終端機輸入0~3鍵，來切換點矩陣LED字型
   5          ***********************************************************/
   6          #include "..\MPC82.H"   //暫存器及組態定義
   7          #include "font4.h"  //字型ABCD資料檔
   8          char word;  //選擇字元
   9          main()
  10          {
  11   1        unsigned char i;      //定義陣列資料計數
  12   1        Scan=0x7F; //由com1開始掃瞄 
  13   1       
  14   1        UART_init(9600); //設定串列環境及鮑率
  15   1        EA=1;ES=1;  //致能串列中斷
  16   1        while(1)   
  17   1         {
  18   2          for(i=0;i<8;i++) //讀取8筆資料掃瞄8次
  19   2           {
  20   3             Data=font4[word*8+i]; //讀取陣列資料
  21   3             Delay_ms(1);    //延時
  22   3           Data=0xFF;     //全暗    
  23   3             Scan=RR8(Scan); //換掃瞄下一行
  24   3           }  
  25   2         }
  26   1      }
  27          //**************************************************
  28          void SCON_int (void)  interrupt 4  //串列中斷函數 
  29           {
  30   1         if(RI==1)
  31   1         {
  32   2          RI=0;     //接收完畢，令RI=0
  33   2          word=SBUF-'0';  //將接收到的字元由P0輸出
  34   2          SBUF=word+'0';   //發射
  35   2         }
  36   1         else TI=0;
  37   1       }
  38          /***********************************************************
  39          *函數名稱: UART_init
  40          *功能描述: UART啟始程式
  41          *輸入參數：bps
  42          ************************************************************/
  43          void UART_init(unsigned int bps)  //UART啟始程式
  44          {  
  45   1         P0M0=0; P0M1=0xFF; //設定P0為推挽式輸出(M0-1=01)
  46   1         SCON=0x50;     //設定UART串列傳輸為MODE1及致能接收
  47   1         TMOD=0x20;     //設定TIMER1為MODE2
  48   1         TH1=256-(57600/bps);  //設計時器決定串列傳輸鮑率
  49   1         TR1=1;          //開始計時
  50   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    164    ----
   CONSTANT SIZE    =     32    ----
C51 COMPILER V9.56.0.0   UART4A                                                            03/13/2020 15:29:31 PAGE 2   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
