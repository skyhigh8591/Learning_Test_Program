C51 COMPILER V9.03   ADC4                                                                  11/27/2011 10:33:26 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE ADC4
OBJECT MODULE PLACED IN ADC4.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ADC4.C OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /************** ADC4.C *******ADC中斷實習範例********
   2          *動作：輸入兩通道類比電壓，由UART發射到電腦顯示電壓值
   3          *      顯示"Ain0=x.xxV  Ain1=x.xxV" 
   4          *硬體：SW3-1~2(Ain0-1) ON，SW3-3(TxD1) ON，調整Ain0的VR2
   5          ****************************************************/
   6          #include "..\MPC82.H"
   7          #include <stdio.h>   //加入基本輸出入函數
   8          bit ch=0;                                                //類比通道
   9          void main(void)
  10          {
  11   1              UART_init(9600); //UART啟始程式，設定串列環境及鮑率
  12   1          TI=1;
  13   1              EA=1;         //致能所有中斷
  14   1          AUXIE = EADC; //致能ADC中斷
  15   1          ADCTL=ADCON + ADCS + 0 ; //由Ain0進行ADC轉換
  16   1          AUXR = ADRJ;      //數位資料ADCH向右移
  17   1          while(1);   //空轉，等待ADC轉換完畢中斷，此時可做其它工作
  18   1      }
  19          /***********************************************************
  20          *函數名稱: output(unsigned long Data)
  21          *功能描述: 將數位資料轉成電壓值發射到電腦
  22          *輸入參數：temp數位資料
  23          ************************************************************/
  24          void output(unsigned long Data)
  25          {
  26   1              Data=(Data*5*100)/1023;    //數位資料轉換成電壓值
  27   1              putchar(Data/100+'0');     //發射資料的百位數
  28   1              putchar('.');              //發射小數點
  29   1              putchar(Data%100/10+'0');  //發射資料的十位數
  30   1              putchar(Data%10+'0');      //發射資料的個位數
  31   1              putchar('V');              //發射電壓
  32   1       }
  33          /***********************************************************
  34          *函數名稱: ADC中斷函數
  35          *功能描述: 整合Ain0-1的10-bit數位資料
  36          ************************************************************/
  37          void ADC_Interrupt()  interrupt 9 
  38          { 
  39   1         unsigned int value0,value1;           //數位資料變數
  40   1         putchar('A'); putchar('i'); putchar('n'); //串列埠發射字串"Ain"
  41   1         if(ch==0)  //若是Ain0類比輸入
  42   1          {
  43   2                ADCTL= 1;      //改為Ain1，停止ADC工作
  44   2                value0=(ADCH<<8) + ADCL; //整合Ain0數位資料
  45   2                putchar('0'); putchar('='); //串列埠發射字串"0="
  46   2                output(value0);  //Ain0數位資料轉換成電壓值,發射出去
  47   2                putchar(' ');putchar(',');putchar(' '); //串列埠發射字串" , "
  48   2              }
  49   1                else  //若是Ain1類比輸入
  50   1             {
  51   2                      ADCTL= 0;    //改為Ain0，停止ADC工作
  52   2                      value1=(ADCH<<8) + ADCL ; //整合Ain1數位資料
  53   2                  putchar('1'); putchar('='); //串列埠發射字串"1="
  54   2                  output(value1); //Ain1數位資料轉換成電壓值,發射出去
  55   2                      putchar('\n');putchar('\r');    //跳行，歸位
C51 COMPILER V9.03   ADC4                                                                  11/27/2011 10:33:26 PAGE 2   

  56   2                  Delay_ms(1000);        //延時
  57   2                 }
  58   1          ch=!ch;  //換另一通道
  59   1          ADCTL=ADCTL+ADCON + ADCS; //重新啟動ADC轉換
  60   1      }
  61          /***********************************************************
  62          *函數名稱: UART_init
  63          *功能描述: UART啟始程式
  64          *輸入參數：bps
  65          ************************************************************/
  66          void UART_init(unsigned int bps)  //UART啟始程式
  67          {
  68   1         SCON = 0x50;     //設定UART串列傳輸為MODE1及致能接收
  69   1         TMOD = 0x20;     //設定TIMER1為MODE2
  70   1         TH1=TL1=256-(57600/bps);  //設計時器決定串列傳輸鮑率
  71   1         TR1 = 1;          //開始計時
  72   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    475    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
